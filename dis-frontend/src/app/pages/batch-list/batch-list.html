<main class="w-full h-full">
  <section class="bg-white p-6 rounded-2xl border-1 border-gray-300">
    <p-table #dataTable
             [value]="batches"
             [(selection)]="selectedBatch"
             [customSort]="true"
             [sortField]="'created_at'"
             [sortOrder]="-1"
             [paginator]="true"
             [first]="first"
             [showCurrentPageReport]="true"
             [rowsPerPageOptions]="[5, 10, 20]"
             [rows]="rows"
             [globalFilterFields]="['batch_id', 'supplier', 'date_delivered', 'valid_until']"
             (onPage)="pageChange($event)"
             (sortFunction)="customSort($event)"
             dataKey="batch_id"
             currentPageReportTemplate="Showing {first} to last of {totalRecords} entries">
      <ng-template #caption>
        <span class="flex justify-between items-center mb-4">
          <h1 class="font-bold text-xl ml-2"> Batch Table </h1>
          <div class="flex gap-5">
            <p-iconfield iconPosition="left" class="ml-auto">
              <p-inputicon>
                <i class="pi pi-search"></i>
              </p-inputicon>
              <input pInputText
                     type="text"
                     placeholder="Search keyword"
                     (input)="onGlobalFilter($event)">
            </p-iconfield>
            <p-button label="Add Batch"
                      icon="pi pi-plus"
                      (onClick)="showDialog()"/>
          </div>
        </span>
      </ng-template>
      <ng-template #header>
        <tr>
          <th style="width: 4rem;"> <p-tableHeaderCheckbox /> </th>
          <th pSortableColumn="batch_id">
            Batch ID <p-sortIcon field="batch_id"/>
          </th>
          <th pSortableColumn="supplier">
            Supplier Name <p-sortIcon field="supplier"/>
          </th>
          <th pSortableColumn="date_delivered">
            Date Delivered <p-sortIcon field="date_delivered"/>
          </th>
          <th pSortableColumn="valid_until">
            Valid Until <p-sortIcon field="valid_until"/>
          </th>
          <th> Action </th>
        </tr>
      </ng-template>
      <ng-template #body let-batch>
        <tr>
          <td> <p-tableCheckbox [value]="batch"/> </td>
          <td> {{ batch.batch_id }} </td>
          <td> {{ batch.supplier }} </td>
          <td> {{ batch.date_delivered }} </td>
          <td> {{ batch.valid_until }} </td>
          <td>
            <p-menu #menuRef [model]="batchMenu" [popup]="true" [appendTo]="'body'" autoZIndex/>
            <p-button pButton icon="pi pi-ellipsis-v" [rounded]="true" [text]="true" severity="secondary" (onClick)="onMenuClick($event, batch); menuRef.toggle($event);"/>
          </td>
        </tr>
      </ng-template>
      <ng-template #paginatorleft></ng-template>
    </p-table>
  </section>
</main>

<p-dialog header="Add Batch"
          [modal]="true"
          maximizable="true"
          [(visible)]="visible"
          [breakpoints]="{ '1199px': '50vw', '575px': '90vw' }"
          [style]="{ width: '30%' }"
          (onHide)="this.reset = !this.reset">
  <app-batch (closeModal)="closeDialog($event)" [resetForm]="reset" />
</p-dialog>

<p-confirmdialog />
