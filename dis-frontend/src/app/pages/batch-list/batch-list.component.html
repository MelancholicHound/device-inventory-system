<main class="page w-full h-full px-9">
    <section class="card p-7 bg-white rounded-xl" *ngIf="!router.url.includes('batch-details')">
        <p-table #dataTable
                 [value]="dataSource"
                 [(selection)]="selectedBatch"
                 [customSort]="true"
                 [paginator]="true"
                 [first]="first"
                 [showCurrentPageReport]="true"
                 [rowsPerPageOptions]="[10, 15, 20]"
                 [rows]="rows"
                 [globalFilterFields]="['formattedId', 'supplier', 'dateDelivered', 'validUntil']"
                 (onPage)="pageChange($event)"
                 (sortFunction)="customSort($event)"
                 dataKey="formattedId"
                 currentPageReportTemplate="Showing {first} to last of {totalRecords} entries">
            <ng-template #caption>
                <div class="flex items-center justify-between mb-2">
                    <h5 class="m-0 font-bold"> Batch Table </h5>
                    <div class="flex items-center gap-5">
                        <p-iconfield iconPosition="left" class="ml-auto">
                            <p-inputicon>
                                <i class="pi pi-search"></i>
                            </p-inputicon>
                            <input pInputText
                                   type="text"
                                   placeholder="Search keyword"
                                   (input)="onGlobalFilter($event)">
                        </p-iconfield>
                        <p-button label="Add Batch"
                                  icon="pi pi-plus"
                                  (onClick)="showDialog()"/>
                    </div>
                </div>
            </ng-template>
            <ng-template #header>
                <tr>
                    <th style="width: 4rem"> <p-tableHeaderCheckbox /> </th>
                    <th pSortableColumn="formattedId">
                        Batch ID <p-sortIcon field="formattedId"/>
                    </th>
                    <th pSortableColumn="supplier">
                        Supplier Name <p-sortIcon field="supplier"/>
                    </th>
                    <th pSortableColumn="dateDelivered">
                        Date Delivered <p-sortIcon field="dateDelivered"/>
                    </th>
                    <th pSortableColumn="validUntil">
                        Valid Until <p-sortIcon field="validUntil"/>
                    </th>
                    <th> Action </th>
                </tr>
            </ng-template>
            <ng-template #body let-batch>
                <tr>
                    <td> <p-tableCheckbox [value]="batch"/> </td>
                    <td> {{ batch.formattedId }} </td>
                    <td> {{ batch.supplier }} </td>
                    <td> {{ batch.dateDelivered }} </td>
                    <td> {{ batch.validUntil }} </td>
                    <td>
                        <p-menu #menuRef [model]="batchMenu" [popup]="true" [appendTo]="dataTable" autoZIndex/>
                        <p-button pButton icon="pi pi-ellipsis-v" [rounded]="true" [text]="true" severity="secondary" (onClick)="onMenuClick($event, batch)"/>
                    </td>
                </tr>
            </ng-template>
            <ng-template #paginatorleft></ng-template>
        </p-table>
    </section>
    <router-outlet *ngIf="router.url.includes('batch-details')"/>
</main>

<p-dialog header="{{ isCreatingBatch() ? 'Add Batch' : 'Add Supplier' }}" [modal]="true" [(visible)]="visible" [style]="{ width: '25%' }">
    <app-batch #batchForm *ngIf="isCreatingBatch()" [isAddingBatch]="updateState" (closeModal)="closeDialog($event)"/>
    <app-supplier #supplierForm *ngIf="!isCreatingBatch()" [isAddingBatch]="updateState" />
</p-dialog>
