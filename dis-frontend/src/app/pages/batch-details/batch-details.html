<span class="bg-white flex justify-between items-center mb-5 p-6 rounded-xl">
  <div class="flex gap-2">
    <h1 class="font-bold text-xl text-slate-600 ml-5"> Batch Number: </h1>
    <h1 class="font-bold text-xl underline text-slate-600"> {{ batchDetails.batch_id }} </h1>
  </div>
  <div class="flex gap-3">
    <p-button label="Batch Details"
              variant="outlined"
              severity="contrast"
              icon="pi pi-list"
              (onClick)="showBatchDetailsDialog()"/>
    <p-button label="Add Device"
              variant="outlined"
              severity="contrast"
              icon="pi pi-plus"
              (onClick)="showAddDeviceDialog()"/>
    <p-button label="Save"
              *ngIf="signalService.deviceSignal()"
              icon="pi pi-check"
              (onClick)="saveButton()" />
    <p-button label="Back"
              severity="contrast"
              icon="pi pi-arrow-left"
              (onClick)="backButton()" />
    <p-button label="Cancel"
              severity="contrast"
              icon="pi pi-times"
              (onClick)="deleteConfirmation($event)"/>
  </div>
</span>
<section class="bg-white rounded-xl p-8">
  <p-table #deviceTable
           [value]="dataSource"
           [(selection)]="selectedDevice"
           [customSort]="true"
           [sortField]="'created_at'"
           [paginator]="true"
           [sortOrder]="-1"
           [first]="first"
           [showCurrentPageReport]="true"
           [rowsPerPageOptions]="[5, 10, 20]"
           [rows]="rows"
           [globalFilterFields]="['device_number', 'device', 'division', 'section']"
           (onPage)="pageChange($event)"
           (sortFunction)="customSort($event)"
           dataKey="device_number"
           currentPageReportTemplate="Showing {first} to last of {totalRecords} entries">
    <ng-template #caption>
      <span class="flex justify-between items-center mb-4">
        <h1 class="font-bold text-xl"> Device Table </h1>
        <div class="flex">
          <p-iconfield iconPosition="left" class="ml-auto">
            <p-inputicon>
              <i class="pi pi-search"></i>
            </p-inputicon>
            <input pInputText
                  type="text"
                  placeholder="Search keyword"
                  (input)="onGlobalFilter($event)">
          </p-iconfield>
        </div>
      </span>
    </ng-template>
    <ng-template #header>
      <tr>
        <th style="width: 4rem;"> <p-tableHeaderCheckbox /> </th>
        <th pSortableColumn="device_number">
          Device Number <p-sortIcon field="device_number"/>
        </th>
        <th pSortableColumn="device">
          Device <p-sortIcon field="device"/>
        </th>
        <th pSortableColumn="division">
          Division <p-sortIcon field="division"/>
        </th>
        <th pSortableColumn="section">
          Section <p-sortIcon field="section"/>
        </th>
        <th> Action </th>
      </tr>
    </ng-template>
    <ng-template #body let-device>
      <tr>
        <td> <p-tableCheckbox [value]="device"/> </td>
        <td> {{ device.device_number }} </td>
        <td> {{ device.device }} </td>
        <td> {{ device.division }} </td>
        <td> {{ device.section }} </td>
        <td>
          <p-menu #menuRef [model]="deviceMenu" [popup]="true" [appendTo]="'body'" autoZIndex/>
          <p-button pButton icon="pi pi-ellipsis-v" [rounded]="true" [text]="true" severity="secondary" (onClick)="onMenuClick($event, device)"/>
        </td>
      </tr>
    </ng-template>
    <ng-template #paginatorleft></ng-template>
  </p-table>
</section>


<p-dialog [modal]="true" [(visible)]="visibleBatchDetails" maximizable="true" [breakpoints]="{ '1199px': '50vw', '575px': '90vw' }" [style]="{ width: '30%' }">
  <ng-template pTemplate="header">
    <span class="text-xl font-semibold"> Batch {{ batchDetails.batch_id }}  Details </span>
  </ng-template>
  <app-batch (closeModal)="closeDialog($event)" [batchDetails]="batchDetails"/>
</p-dialog>

<p-dialog header="Add Device"
          [modal]="true"
          [(visible)]="visibleAddDevice"
          maximizable="true"
          [breakpoints]="{ '1199px': '50vw', '575px': '90vw' }"
          [style]="{ width: '30%' }"
          (onHide)="resetOnHide()">
  <form class="flex flex-col gap-4 w-full" [formGroup]="addDeviceForm">
    <span class="flex flex-col justify-between w-full">
      <label for="device"> Device </label>
      <p-select inputId="device"
                class="w-full"
                [options]="devices"
                [appendTo]="'body'"
                [checkmark]="true"
                [showClear]="true"
                optionLabel="name"
                optionValue="indicator"
                placeholder="Select a device"
                formControlName="device"/>
    </span>
    <span class="flex flex-col gap-1">
      <label for="quantity"> Quantity </label>
      <p-inputnumber inputId="quantity"
                     mode="decimal"
                     class="w-1/3"
                     styleClass="w-1/3"
                     inputStyleClass="w-1/3"
                     [showButtons]="true"
                     [min]="1"
                     [max]="100"
                     formControlName="quantity"/>
    </span>
  </form>
  <ng-template #footer>
    <p-button label="Cancel"
              severity="contrast"/>
    <p-button label="Add Device"
              (onClick)="addDevice()"/>
  </ng-template>
</p-dialog>

<p-confirmdialog />
