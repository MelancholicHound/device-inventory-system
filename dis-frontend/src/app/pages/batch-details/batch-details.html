<span class="bg-white flex justify-between items-center mb-5 p-6 rounded-xl  border-1 border-gray-300">
  <div class="flex flex-col gap-2">
    <h1 class="font-bold text-xl ml-5"> Batch Number: </h1>
    <h1 class="font-bold text-xl underline text-slate-600 ml-5"> {{ batchDetails?.batch_id }} </h1>
  </div>
  <div class="flex gap-3">
    <p-button label="Batch Details"
              variant="outlined"
              severity="contrast"
              icon="pi pi-list"
              (onClick)="showBatchDetailsDialog()"/>
    <p-button label="Add Device"
              variant="outlined"
              severity="contrast"
              icon="pi pi-plus"
              (onClick)="showAddDeviceDialog()"/>
    @if (signalService.isDeviceCountChanged() || signalService.isUPSCountChanged()) {
    <p-button label="Save"
              icon="pi pi-check"
              (onClick)="saveButton()" />
    }
    <p-button label="Back"
              severity="contrast"
              icon="pi pi-arrow-left"
              (onClick)="backButton()" />
  </div>
</span>
<section class="bg-white rounded-xl p-8 border-1 border-gray-300">
  <p-tabs value="0">
    <p-tablist>
      <p-tab value="0" class="flex items-center !gap-2 text-inherit">
        <i class="pi pi-desktop"></i>
        Device </p-tab>
      <p-tab value="1" class="flex items-center !gap-2 text-inherit">
        <i class="pi pi-bolt"></i>
        UPS </p-tab>
    </p-tablist>
    <p-tabpanels>
      <p-tabpanel value="0">
        <p-table #deviceTable
                 [value]="deviceDataSource"
                 [(selection)]="selectedDevice"
                 [customSort]="true"
                 [sortField]="'created_at'"
                 [paginator]="true"
                 [sortOrder]="-1"
                 [first]="firstDevice"
                 [showCurrentPageReport]="true"
                 [rowsPerPageOptions]="[5, 10, 20]"
                 [rows]="rowsDevice"
                 [globalFilterFields]="['device_number', 'device', 'division', 'section']"
                 (onPage)="pageChangeDevice($event)"
                 (sortFunction)="customDeviceSort($event)"
                 dataKey="device_number"
                 currentPageReportTemplate="Showing {{firstDevice}} to last of {totalRecords} entries">
          <ng-template #header>
            <tr>
              <th style="width: 4rem;"> <p-tableHeaderCheckbox /> </th>
              <th pSortableColumn="device_number">
                Device Number <p-sortIcon field="device_number"/>
              </th>
              <th pSortableColumn="device">
                Device <p-sortIcon field="device"/>
              </th>
              <th pSortableColumn="division">
                Division <p-sortIcon field="division"/>
              </th>
              <th pSortableColumn="section">
                Section <p-sortIcon field="section"/>
              </th>
              <th> Action </th>
            </tr>
          </ng-template>
          <ng-template #body let-device>
            <tr>
              <td> <p-tableCheckbox [value]="device"/> </td>
              <td> {{ device.device_number }} </td>
              <td> {{ device.device }} </td>
              <td> {{ device.division }} </td>
              <td> {{ device.section }} </td>
              <td>
                <p-menu #deviceMenuRef [model]="deviceMenu" [popup]="true" [appendTo]="'body'" autoZIndex/>
                <p-button pButton icon="pi pi-ellipsis-v" [rounded]="true" [text]="true" severity="secondary" (onClick)="onDeviceMenuClick($event, device)"/>
              </td>
            </tr>
          </ng-template>
          <ng-template #paginatorleft></ng-template>
        </p-table>
      </p-tabpanel>
      <p-tabpanel value="1">
        <p-table #upsTable
                 [value]="upsDataSource"
                 [(selection)]="selectedUPS"
                 [customSort]="true"
                 [sortField]="'created_at'"
                 [paginator]="true"
                 [sortOrder]="-1"
                 [first]="firstUPS"
                 [showCurrentPageReport]="true"
                 [rowsPerPageOptions]="[5, 10, 20]"
                 [rows]="rowsUPS"
                 [globalFilterFields]="['device_number', 'is_available', 'name', 'model']"
                 (onPage)="pageChangeUPS($event)"
                 (sortFunction)="customUPSSort($event)"
                 dataKey="device_number"
                 currentPageReportTemplate="Showing {{firstUPS}} to last of {totalRecords} entries">
          <ng-template #header>
            <tr>
              <th style="width: 4rem;"> <p-tableHeaderCheckbox /> </th>
              <th pSortableColumn="device_number">
                Device Number <p-sortIcon field="device_number"/>
              </th>
              <th pSortableColumn="name">
                Brand Name <p-sortIcon field="name"/>
              </th>
              <th pSortableColumn="model">
                Model <p-sortIcon field="model"/>
              </th>
              <th pSortableColumn="is_available">
                Status <p-sortIcon field="is_available"/>
              </th>
              <th> Action </th>
            </tr>
          </ng-template>
          <ng-template #body let-ups>
            <tr>
              <td> <p-tableCheckbox [value]="ups"/> </td>
              <td> {{ ups.device_number }} </td>
              <td> {{ ups.name }} </td>
              <td> {{ ups.model }} </td>
              <td> {{ ups.is_available ? 'Available' : 'Deployed' }} </td>
              <td>
                <p-menu #upsMenuRef [model]="deviceMenu" [popup]="true" [appendTo]="'body'" autoZIndex/>
                <p-button pButton icon="pi pi-ellipsis-v" [rounded]="true" [text]="true" severity="secondary" (onClick)="onDeviceMenuClick($event, ups)"/>
              </td>
            </tr>
          </ng-template>
          <ng-template #paginatorleft></ng-template>
        </p-table>
      </p-tabpanel>
    </p-tabpanels>
  </p-tabs>
</section>


<p-dialog [modal]="true" [(visible)]="visibleBatchDetails" maximizable="true" [breakpoints]="{ '1199px': '50vw', '575px': '90vw' }" [style]="{ width: '30%' }" (onHide)="restoreOnHide()">
  <ng-template pTemplate="header">
    <span class="text-xl font-semibold"> Batch {{ batchDetails.batch_id }}  Details </span>
  </ng-template>
  <app-batch (closeModal)="closeDialog($event)" [batchDetails]="batchDetails" [resetForm]="resetForm" />
</p-dialog>

<p-dialog header="Add Device"
          [modal]="true"
          [(visible)]="visibleAddDevice"
          maximizable="true"
          [breakpoints]="{ '1199px': '50vw', '575px': '90vw' }"
          [style]="{ width: '30%' }"
          (onHide)="resetOnHide()">
  <form class="flex flex-col gap-4 w-full" [formGroup]="addDeviceForm">
    <span class="flex flex-col justify-between w-full">
      <label for="device"> Device </label>
      <p-select inputId="device"
                class="w-full"
                [options]="devices"
                [appendTo]="'body'"
                [checkmark]="true"
                [showClear]="true"
                optionLabel="name"
                optionValue="indicator"
                placeholder="Select a device"
                formControlName="device"/>
    </span>
    <span class="flex flex-col gap-1">
      <label for="quantity"> Quantity </label>
      <p-inputnumber inputId="quantity"
                     mode="decimal"
                     class="w-1/3"
                     styleClass="w-1/3"
                     inputStyleClass="w-1/3"
                     [showButtons]="true"
                     [min]="1"
                     [max]="100"
                     formControlName="quantity"/>
    </span>
  </form>
  <ng-template #footer>
    <p-button label="Cancel"
              severity="contrast"/>
    <p-button label="Add Device"
              (onClick)="addDevice()"/>
  </ng-template>
</p-dialog>

<p-confirmdialog />
