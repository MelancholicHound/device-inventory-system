<form action="" [formGroup]="computerForm" class="w-full mb-15" autocomplete="off">
  <div class="bg-white rounded-xl p-5 w-full shadow-lg">
    <h1 class="text-xl font-semibold mb-5"> Computer Device Information </h1>

    <!-- Batch and Save -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div class="flex flex-col sm:flex-row gap-5">
        <blockquote class="flex items-center gap-2">
          <p class="text-slate-600">Batch Number:</p>
          <p class="underline font-semibold">{{ batchDetails()?.batch_id }}</p>
        </blockquote>
        <blockquote class="flex items-center gap-2">
          <p class="text-slate-600">Quantity:</p>
          <p class="underline font-semibold">{{ quantity() }}</p>
        </blockquote>
      </div>
      <div class="flex gap-3">
        @if (computerForm.valid) {
        <p-button label="Save"
                  class="w-full sm:w-auto"
                  [style]="{ width: '100px' }"
                  (onClick)="postComputer()" />
        }
        <p-button label="Back"
                  class="w-full sm:w-auto"
                  [style]="{ width: '100px' }"
                  severity="contrast"
                  (onClick)="backButton()"/>
      </div>
    </div>

    <!-- Form Fields Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mt-6 w-full">

      <!-- Division -->
      <span class="flex flex-col w-full">
        <label for="division" class="text-slate-600 mb-1 font-semibold">Division:</label>
        <p-select inputId="division"
                  class="w-full"
                  [options]="signalService.divisions()"
                  optionLabel="name"
                  optionValue="id"
                  (onChange)="getSectionSelectValue($event)" />
      </span>

      <!-- Section -->
      <span class="flex flex-col w-full">
        <label for="section" class="text-slate-600 mb-1 font-semibold">Section:</label>
        <p-select inputId="section"
                  class="w-full"
                  [options]="sectionsByDivId()"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="section_id" />
      </span>
    </div>
  </div>
  <div class="bg-white rounded-xl p-5 w-full mt-5">
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 w-full">
      <span class="flex flex-col">
        <label for="serial" class="font-semibold mb-1 text-slate-600"> Serial Number: </label>
        <input type="text" pInputText formControlName="serial_number" id="serial" formControlName="serial_number">
      </span>
      <span class="flex flex-col">
        <label for="ups" class="font-semibold mb-1 text-slate-600"> UPS </label>
        <p-treeselect [options]="node"
                      formControlName="ups_id"
                      [selectionMode]="'single'"
                      (onNodeSelect)="getSelectedUPS($event)" />
      </span>
      <span class="flex flex-col">
        <label for="conns" class="font-semibold mb-1 text-slate-600"> Connections: </label>
        <p-multiselect [options]="signalService.connections()"
                        optionLabel="name"
                        optionValue="id"
                        display="chip"
                        formControlName="connectionDTO"/>
      </span>
      <span class="flex flex-col">
        <label for="perips" class="font-semibold mb-1 text-slate-600"> Peripherals: </label>
        <p-multiselect [options]="signalService.peripherals()"
                        optionLabel="name"
                        optionValue="id"
                        display="chip"
                        formControlName="peripheralDTO"/>
      </span>
    </div>
  </div>
  <section class="grid grid-cols-1 m:grid-cols-2 lg:grid-cols-3 gap-5 mt-5 w-full">
    <!-- Accountability -->
    <div class="flex flex-col p-5 bg-white rounded-xl w-full">
      <p class="font-semibold mb-4 text-slate-600"> Accountability </p>
      <div class="flex flex-col gap-5">
        <span class="flex flex-col">
          <label for="acct" class="text-slate-600">Accountable Person</label>
          <input type="text" pInputText class="w-full" formControlName="accountable_user">
        </span>
        <span class="flex flex-col">
          <label for="acct" class="text-slate-600">Accountable Person</label>
          <input type="text" pInputText class="w-full" formControlName="co_accountable_user">
        </span>
      </div>
    </div>

    <!-- Processor -->
    <div class="flex flex-col p-5 bg-white rounded-xl w-full" formGroupName="processorDTO">
      <p class="font-semibold mb-4 text-slate-600">Processor</p>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
        <span class="flex flex-col w-full">
          <label for="brand" class="text-slate-600">Brand</label>
          <p-select inputId="brand"
                    [options]="signalService.procBrand()"
                    optionLabel="name"
                    optionValue="id"
                    (onChange)="getProcSeriesSelectValue($event)" />
        </span>
        <span class="flex flex-col w-full">
          <label for="series" class="text-slate-600">Series</label>
          <p-select inputId="series"
                    [options]="seriesByBrandId()"
                    optionLabel="name"
                    optionValue="id"
                    formControlName="series_id" />
        </span>
      </div>
      <span class="flex flex-col w-full mt-5">
        <label for="model" class="text-slate-600">Model</label>
        <input type="text" pInputText class="w-full" formControlName="model">
      </span>
    </div>

    <!-- Motherboard -->
    <div class="flex flex-col p-5 bg-white rounded-xl w-full" formGroupName="motherboardDTO">
      <p class="font-semibold mb-4 text-slate-600"> Motherboard </p>
      <div class="flex flex-col gap-5">
        <span class="flex flex-col">
          <label for="acct" class="text-slate-600">Brand</label>
          <p-select inputId="brand"
                    [options]="moboBrand()"
                    optionLabel="name"
                    optionValue="id"
                    [editable]="true"
                    formControlName="brand_id" />
        </span>
        <span class="flex flex-col">
          <label for="acct" class="text-slate-600">Model</label>
          <input type="text" pInputText class="w-full" formControlName="model">
        </span>
      </div>
    </div>

    <!-- Video Card -->
    <div class="flex flex-col p-5 bg-white rounded-xl w-full">
      <p class="font-semibold mb-4 text-slate-600">Video Card</p>
      <div class="flex flex-col w-full">
        <p class="text-slate-600">Capacity</p>
        <div class="flex gap-3 items-center w-full">
          <p-select inputId="capacity"
                    class="w-full"
                    [options]="signalService.gpu()"
                    [editable]="true"
                    optionLabel="capacity"
                    optionValue="id"
                    formControlName="gpu_id" />
          <label for="capacity" class="text-slate-600">Gb/s</label>
        </div>
      </div>
    </div>

    <!-- RAM -->
    <div formArrayName="ramDTO" class="flex flex-col p-5 bg-white rounded-xl w-full">
      <p class="font-semibold mb-4 text-slate-600">RAM</p>

      @for (ram of ramArray.controls; track $index) {
        <ng-container [formGroupName]="$index">
            <div class="flex flex-col">
              <p class="text-slate-600"> Capacity </p>
              <div class="flex gap-3 items-center mb-3">
                <p-select formControlName="capacity_id"
                          inputId="ram-capacity-{{$index}}"
                          class="w-full"
                          [options]="signalService.ram()"
                          [editable]="true"
                          [showClear]="true"
                          optionLabel="capacity"
                          optionValue="id" />
                <label for="ram-capacity-{{$index}}" class="text-slate-600">Gb/s</label>

                @if (ramArray.length > 1) {
                  <p-button label="Remove"
                            severity="danger"
                            styleClass="p-button-sm"
                            (onClick)="removeRAM($index)" />
                }
              </div>
            </div>
          </ng-container>
      }

      <div class="flex gap-3 items-center mt-2">
        <p>Add RAM:</p>
        <p-button icon="pi pi-plus" styleClass="p-button-sm" (onClick)="addRAM()" />
      </div>
    </div>


    <!-- Storage -->
    <div formArrayName="storageDTO" class="flex flex-col p-5 bg-white rounded-xl w-full">
      <p class="font-semibold mb-4 text-slate-600">Storage</p>

      <div class="flex flex-col gap-5">
        @for (storage of storageArray.controls; track $index) {
          <ng-container [formGroupName]="$index">
            <div class="flex flex-col gap-3 border border-slate-200 rounded p-3">

              <div class="flex flex-col">
                <p class="text-slate-600">Capacity </p>
                <span class="flex gap-3 items-center w-full">
                  <p-select inputId="capacity-{{$index}}"
                            class="w-full"
                            [options]="signalService.storage()"
                            [editable]="true"
                            optionLabel="capacity"
                            optionValue="id"
                            [showClear]="true"
                            formControlName="capacity_id"/>
                  <label for="capacity-{{$index}}" class="text-slate-600">Gb/s</label>

                  @if (storageArray.length > 1) {
                    <p-button label="Remove"
                              severity="danger"
                              styleClass="p-button-sm"
                              (onClick)="removeStorage($index)" />
                  }
                </span>
              </div>

              <div class="flex flex-col">
                <label for="type-{{$index}}" class="text-slate-600">Type</label>
                <p-select inputId="type-{{$index}}"
                          class="w-full"
                          [options]="signalService.storageType()"
                          optionLabel="type"
                          optionValue="id"
                          formControlName="type_id" />
              </div>
            </div>
          </ng-container>
        }
        <div class="flex gap-3 items-center mt-2">
          <p>Add storage:</p>
          <p-button icon="pi pi-plus"
                    styleClass="p-button-sm"
                    (onClick)="addStorage()" />
        </div>
      </div>
    </div>

    <!-- Softwares -->
    <div class="flex flex-col p-5 bg-white rounded-xl w-full">
      <p class="font-semibold mb-4 text-slate-600">Softwares</p>
      <div class="grid grid-cols-1  gap-5">
        <span class="flex flex-col">
          <label for="os" class="text-slate-600">Operating System</label>
          <p-select inputId="os"
                    [options]="signalService.os()"
                    [editable]="true"
                    optionLabel="name"
                    optionValue="id"
                    formControlName="os_id"/>
        </span>
        <span class="flex flex-col">
          <label for="prod" class="text-slate-600">Productivity Tool</label>
          <p-select inputId="prod"
                    [options]="signalService.productivityTools()"
                    [editable]="true"
                    optionLabel="name"
                    optionValue="id"
                    formControlName="prod_id"/>
        </span>
        <span class="flex flex-col">
          <label for="sec" class="text-slate-600">Security</label>
          <p-select inputId="sec"
                    [options]="signalService.security()"
                    [editable]="true"
                    optionLabel="name"
                    optionValue="id"
                    formControlName="security_id"/>
        </span>
      </div>
    </div>
  </section>
</form>
